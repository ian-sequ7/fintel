---
import Layout from "../../layouts/Layout.astro";
import Card from "../../components/primitives/Card.astro";
import FilterBar from "../../components/composed/FilterBar.astro";
import NewsCard from "../../components/composed/NewsCard.astro";
import { getNews } from "../../data/report";
import type { NewsCategory } from "../../data/types";

// Prerender this page statically at build time
export const prerender = true;

// Static paths for SSG
export function getStaticPaths() {
  return [
    { params: { category: "market" } },
    { params: { category: "company" } },
  ];
}

const { category } = Astro.params as { category: NewsCategory };
const allNews = getNews(category);

// Dynamic page title
const categoryTitles: Record<string, string> = {
  market: "Market News",
  company: "Company News",
};
const pageTitle = categoryTitles[category] || "News Feed";

const categoryDescriptions: Record<string, string> = {
  market: "Market-wide financial news covering indices, sectors, and economic trends.",
  company: "Company-specific news and updates for stocks in your watchlist.",
};
const pageDescription = categoryDescriptions[category] || "Latest financial news and updates.";

const filterTabs = [
  { value: "all", label: "All News", href: "/news" },
  { value: "market", label: "Market", href: "/news/market" },
  { value: "company", label: "Company", href: "/news/company" },
];
---

<Layout title={pageTitle} description={pageDescription}>
  <!-- Page header -->
  <div class="mb-6">
    <h1 class="text-2xl font-bold text-text-primary">{pageTitle}</h1>
    <p class="text-text-secondary">
      {allNews.length} articles
    </p>
  </div>

  <!-- Filters -->
  <div class="mb-6">
    <FilterBar
      tabs={filterTabs}
      currentValue={category}
    />
  </div>

  <!-- News list -->
  {allNews.length === 0 ? (
    <Card>
      <p class="text-text-secondary text-center py-8">
        No news articles found for this category.
      </p>
    </Card>
  ) : (
    <div class="space-y-4">
      {allNews.map((news) => (
        <NewsCard news={news} />
      ))}
    </div>
  )}
</Layout>
