---
import Layout from "../layouts/Layout.astro";
import Card from "../components/primitives/Card.astro";
import FilterBar from "../components/composed/FilterBar.astro";
import NewsCard from "../components/composed/NewsCard.astro";
import { getNews } from "../data/report";
import type { NewsCategory } from "../data/types";

// Get filter from URL params
const filterParam = Astro.url.searchParams.get("filter") ?? "all";

// Get news based on filter (already sorted by date in getNews)
const category = filterParam === "all" ? "all" : filterParam as NewsCategory;
const allNews = getNews(category);

const filterOptions = [
  { value: "all", label: "All News" },
  { value: "market", label: "Market" },
  { value: "company", label: "Company" },
];
---

<Layout title="News Feed">
  <!-- Page header -->
  <div class="mb-6">
    <h1 class="text-2xl font-bold text-text-primary">News Feed</h1>
    <p class="text-text-secondary">
      {allNews.length} articles from financial sources
    </p>
  </div>

  <!-- Filters -->
  <div class="mb-6">
    <FilterBar
      filters={filterOptions}
      activeFilter={filterParam}
      paramName="filter"
    />
  </div>

  <!-- News list -->
  {allNews.length === 0 ? (
    <Card>
      <p class="text-text-secondary text-center py-8">
        No news articles found.
      </p>
    </Card>
  ) : (
    <div class="space-y-4">
      {allNews.map((news) => (
        <NewsCard news={news} />
      ))}
    </div>
  )}
</Layout>
