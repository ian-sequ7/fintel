---
import Badge from "../primitives/Badge.astro";
import type { MacroRisk } from "../../data/types";

interface Props {
  risk: MacroRisk;
  class?: string;
}

const { risk, class: className = "" } = Astro.props;

const severityColors = {
  low: "success",
  medium: "warning",
  high: "danger",
} as const;

// Severity bar levels (1-3)
const severityLevels = {
  low: 1,
  medium: 2,
  high: 3,
};

// Severity bar colors (all red-scaled for risk)
const severityBarColors = {
  low: "bg-warning",
  medium: "bg-danger/70",
  high: "bg-danger",
};

// Format sector names for display
function _formatSector(sector: string): string {
  return sector
    .replace(/_/g, " ")
    .replace(/\b\w/g, (c) => c.toUpperCase());
}
---

<div
  class:list={[
    "bg-bg-surface border border-border rounded-lg p-4",
    className,
  ]}
>
  <!-- Header: Name + Severity badge -->
  <div class="flex items-start justify-between mb-3">
    <h4 class="font-semibold text-text-primary text-lg">{risk.name}</h4>
    <Badge text={risk.severity.toUpperCase()} variant={severityColors[risk.severity]} size="sm" />
  </div>

  <!-- Severity bar (red-scaled) -->
  <div class="flex gap-1 mb-3">
    {
      [1, 2, 3].map((level) => (
        <div
          class:list={[
            "h-2 flex-1 rounded-full transition-colors",
            level <= severityLevels[risk.severity]
              ? severityBarColors[risk.severity]
              : "bg-bg-elevated",
          ]}
        />
      ))
    }
  </div>

  <!-- Description -->
  <p class="text-sm text-text-secondary mb-4 leading-relaxed">
    {risk.description}
  </p>

  <!-- Affected sectors -->
  {
    risk.affectedSectors && risk.affectedSectors.length > 0 && (
      <div>
        <p class="text-xs font-medium text-text-secondary uppercase tracking-wide mb-2">
          Affected Sectors
        </p>
        <div class="flex flex-wrap gap-1">
          {risk.affectedSectors.map((sector) => (
            <Badge text={_formatSector(sector)} variant="neutral" size="sm" />
          ))}
        </div>
      </div>
    )
  }

  <!-- Potential impact if available -->
  {
    risk.potentialImpact && (
      <div class="mt-3 pt-3 border-t border-border">
        <p class="text-xs text-text-secondary">
          <span class="font-medium">Potential Impact:</span> {risk.potentialImpact}
        </p>
      </div>
    )
  }
</div>
