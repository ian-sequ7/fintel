---
import Badge from "../primitives/Badge.astro";
import ConvictionBar from "../primitives/ConvictionBar.astro";
import type { StockPick } from "../../data/types";

interface Props {
  pick: StockPick;
  showTimeframe?: boolean;
  class?: string;
}

const { pick, showTimeframe = true, class: className = "" } = Astro.props;

const timeframeLabels = {
  short: "Short-term",
  medium: "Medium-term",
  long: "Long-term",
};

const timeframeColors = {
  short: "accent",
  medium: "warning",
  long: "success",
} as const;

function _formatPrice(price: number | undefined): string {
  if (price === undefined) return "-";
  return `$${price.toFixed(2)}`;
}
---

<a
  href={`/stock/${pick.ticker}`}
  class:list={[
    "block bg-bg-surface border border-border rounded-lg p-4 hover:border-accent transition-colors",
    className,
  ]}
>
  <div class="flex items-start justify-between mb-3">
    <div class="flex items-center gap-2">
      <span class="text-lg font-bold text-text-primary">{pick.ticker}</span>
      {
        showTimeframe && (
          <Badge text={timeframeLabels[pick.timeframe]} variant={timeframeColors[pick.timeframe]} />
        )
      }
    </div>
    {
      pick.entryPrice && (
        <span class="text-sm text-text-secondary">
          Entry: {_formatPrice(pick.entryPrice)}
        </span>
      )
    }
  </div>

  <p class="text-sm text-text-secondary mb-3 line-clamp-2">
    {pick.thesis}
  </p>

  <ConvictionBar score={pick.convictionScore} size="sm" />

  {
    pick.riskFactors.length > 0 && (
      <div class="mt-3 flex flex-wrap gap-1">
        {pick.riskFactors.slice(0, 3).map((risk) => (
          <Badge text={risk} variant="danger" size="sm" />
        ))}
      </div>
    )
  }

  {
    pick.targetPrice && (
      <div class="mt-3 flex items-center justify-between text-xs text-text-secondary">
        <span>Target: {_formatPrice(pick.targetPrice)}</span>
        {pick.stopLoss && <span>Stop: {_formatPrice(pick.stopLoss)}</span>}
      </div>
    )
  }
</a>
