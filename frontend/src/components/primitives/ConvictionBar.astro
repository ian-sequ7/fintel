---
interface Props {
  score: number; // Accepts 0-1 (normalized) or 1-10 scale
  showLabel?: boolean;
  size?: "sm" | "md";
  class?: string;
}

const { score, showLabel = true, size = "md", class: className = "" } = Astro.props;

// Normalize score to 1-10 scale
// If score <= 1, assume it's 0-1 scale and convert to 1-10
const score10 = score <= 1 ? Math.round(score * 10) : Math.round(score);
const clampedScore = Math.max(1, Math.min(10, score10));
const percentage = clampedScore * 10;

// Color based on 1-10 scale: 1-4 danger, 5-6 warning, 7-10 success
function _getColor(s: number): string {
  if (s >= 7) return "bg-success";
  if (s >= 5) return "bg-warning";
  return "bg-danger";
}

const barColor = _getColor(clampedScore);

const sizeClasses = {
  sm: "h-1.5",
  md: "h-2.5",
};

const labelSizes = {
  sm: "text-xs",
  md: "text-sm",
};
---

<div class:list={["w-full", className]}>
  {
    showLabel && (
      <div class="flex justify-between items-center mb-1">
        <span class:list={["font-medium text-text-secondary", labelSizes[size]]}>
          Conviction
        </span>
        <span class:list={["font-semibold text-text-primary", labelSizes[size]]}>
          {clampedScore}/10
        </span>
      </div>
    )
  }
  <div class:list={["w-full bg-bg-elevated rounded-full overflow-hidden", sizeClasses[size]]}>
    <div
      class:list={["h-full rounded-full transition-all duration-300", barColor]}
      style={`width: ${percentage}%`}
    >
    </div>
  </div>
</div>
